<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Transformers.js</title>
</head>
<body>
    <h1>Transformers.js Model Loading Test</h1>
    <div id="status">Testing...</div>
    <pre id="logs"></pre>

    <script type="module">
        import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2';

        const statusDiv = document.getElementById('status');
        const logsDiv = document.getElementById('logs');

        function log(message) {
            console.log(message);
            logsDiv.textContent += message + '\n';
        }

        // Configure environment
        env.allowLocalModels = false;
        env.allowRemoteModels = true;
        
        log('Environment configured');
        log('CDN: ' + env.backends.onnx.wasm.wasmPaths);
        
        async function testModelLoading() {
            try {
                statusDiv.textContent = 'Loading Whisper model...';
                log('üé§ Attempting to load Whisper tiny.en...');
                
                const pipe = await pipeline(
                    'automatic-speech-recognition',
                    'Xenova/whisper-tiny.en',
                    {
                        quantized: true,
                        progress_callback: (progress) => {
                            log(`Progress: ${progress.status} - ${progress.file || ''}`);
                            if (progress.status === 'downloading') {
                                const percent = Math.round((progress.loaded / progress.total) * 100);
                                statusDiv.textContent = `Downloading ${progress.file}: ${percent}%`;
                            }
                        }
                    }
                );
                
                log('‚úÖ Model loaded successfully!');
                statusDiv.textContent = 'Model loaded successfully!';
                statusDiv.style.color = 'green';
                
            } catch (error) {
                log('‚ùå Error: ' + error.message);
                log('Stack: ' + error.stack);
                statusDiv.textContent = 'Failed to load model';
                statusDiv.style.color = 'red';
            }
        }

        testModelLoading();
    </script>
</body>
</html>
